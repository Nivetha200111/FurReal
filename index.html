<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PawPrint AI - AI Detection for Instagram</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-neutral-950 text-white min-h-screen">
    <div class="max-w-md mx-auto p-4 space-y-4">
        <h1 class="text-2xl font-bold">PawPrint AI</h1>
        <p class="text-sm text-neutral-400">Server: online</p>
        
        <div class="space-y-4">
            <form id="analysisForm" class="flex flex-col space-y-2">
                <input
                    type="text"
                    id="instagramUrl"
                    placeholder="Enter Instagram URL or @username"
                    class="p-3 rounded-md bg-neutral-800 text-white border border-neutral-700 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                />
                <button
                    type="submit"
                    id="analyzeBtn"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-md transition duration-200 ease-in-out disabled:opacity-50"
                >
                    Analyze
                </button>
            </form>

            <div id="result" class="hidden bg-neutral-800 p-4 rounded-lg shadow-md space-y-3">
                <div class="flex items-center space-x-3">
                    <img id="thumbnail" src="" alt="Thumbnail" class="w-16 h-16 object-cover rounded-md hidden" />
                    <div class="flex-1">
                        <div class="flex items-center space-x-2 mb-1">
                            <h3 id="label" class="text-lg font-semibold"></h3>
                            <span id="probability" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium text-white"></span>
                        </div>
                        <p id="author" class="text-sm text-neutral-400"></p>
                    </div>
                </div>
                <p id="caption" class="text-sm text-neutral-300 line-clamp-2"></p>
                <div id="signals" class="hidden">
                    <p class="text-xs font-semibold text-neutral-500 mb-1">Signals:</p>
                    <ul id="signalsList" class="text-xs text-neutral-400 list-disc list-inside"></ul>
                </div>
                <p id="mode" class="text-xs text-neutral-500"></p>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('analysisForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const url = document.getElementById('instagramUrl').value;
            const analyzeBtn = document.getElementById('analyzeBtn');
            const result = document.getElementById('result');
            
            if (!url.trim()) return;
            
            analyzeBtn.textContent = 'Analyzing...';
            analyzeBtn.disabled = true;
            result.classList.add('hidden');
            
            try {
                const response = await fetch(`/api/analyze/post?url=${encodeURIComponent(url)}`);
                const data = await response.json();
                
                if (data.summary) {
                    document.getElementById('label').textContent = data.summary.label;
                    document.getElementById('probability').textContent = `AI: ${data.summary.aiProbability}%`;
                    document.getElementById('probability').className = `inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium text-white ${
                        data.summary.aiProbability >= 70 ? 'bg-red-600' : 
                        data.summary.aiProbability >= 40 ? 'bg-yellow-500' : 'bg-green-600'
                    }`;
                    document.getElementById('author').textContent = data.summary.authorUsername ? `@${data.summary.authorUsername}` : '';
                    document.getElementById('caption').textContent = data.summary.caption || '';
                    document.getElementById('mode').textContent = `Mode: ${data.summary.mode}`;
                    
                    if (data.summary.thumbnailUrl) {
                        document.getElementById('thumbnail').src = data.summary.thumbnailUrl;
                        document.getElementById('thumbnail').classList.remove('hidden');
                    }
                    
                    if (data.detailedFindings?.signals?.length > 0) {
                        const signalsList = document.getElementById('signalsList');
                        signalsList.innerHTML = '';
                        data.detailedFindings.signals.forEach(signal => {
                            const li = document.createElement('li');
                            li.textContent = signal;
                            signalsList.appendChild(li);
                        });
                        document.getElementById('signals').classList.remove('hidden');
                    }
                    
                    result.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Analysis failed:', error);
                alert('Analysis failed. Please try again.');
            } finally {
                analyzeBtn.textContent = 'Analyze';
                analyzeBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
